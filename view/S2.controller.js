/*
 * Copyright (C) 2009-2014 SAP SE or an SAP affiliate company. All rights reserved
 */
jQuery.sap.require("ui.s2p.mm.purchorder.approve.util.Conversions");jQuery.sap.require("sap.ca.scfld.md.controller.ScfldMasterController");sap.ca.scfld.md.controller.ScfldMasterController.extend("ui.s2p.mm.purchorder.approve.view.S2",{onInit:function(){this.getView().getModel().setSizeLimit(1000000);this.getData();var c=sap.ui.core.Component.getOwnerIdFor(this.getView());var C=sap.ui.component(c);C.oEventBus.subscribe("ui.s2p.mm.purchorder.approve","selectNextWorkItem",this._selectNextWorkItem,this);var l=this.getList();this.oRouter.attachRoutePatternMatched(function(e){if(e.getParameter("name")==="detail"){var b=this.getBindingContextPathFor(e.getParameter("arguments"));var i=this.findItemByContextPath(b);var I=l.indexOfItem(i);var a=l.getItems().length;if(a>1){var n=0;if(a===I+1){n=I-1}else{n=I+1}var N=l.getItems()[n];var o=l.getItems()[I];this._sNextDetailPath=N&&N.getBindingContext(this.sModelName).getPath();this._sCurrentDetailPath=i&&o.getBindingContext(this.sModelName).getPath()}}},this);if(this.extHookOnInit){this.extHookOnInit()}l.attachEvent("updateFinished",function(){var o=this.findItemByContextPath(this._sCurrentDetailPath);var i=this.findItemByContextPath(this._sNextDetailPath);if(!sap.ui.Device.system.phone){if(o){this.setListItem(o)}else if(i){this.setListItem(i)}else{if(this.getList().getItems().length>=1){this.selectFirstItem()}else{this.showEmptyView("DETAIL_TITLE","NO_ITEMS_AVAILABLE")}}}},this)},_selectNextWorkItem:function(c,e,d){if(e==="selectNextWorkItem"){if(sap.ui.Device.system.phone){window.history.go(-1)}var l=this.getList();l.getBinding('items').refresh();l.attachEventOnce("updateFinished",function(){if(d.bMessageToast&&d.bMessageToast===true&&d.sMessage){sap.m.MessageToast.show(d.sMessage,{duration:3500})}},this)}},getData:function(){var l=this.getList();var t=l.getItems()[0].clone();var s=new sap.ui.model.Sorter("WiCreatedAt",true);var f=[];l.bindItems("/WorkflowTaskCollection",t,s,f)},getHeaderFooterOptions:function(){var l={sI18NMasterTitle:"MASTER_TITLE"};if(this.extHookSetHeaderFooterOptions){l=this.extHookSetHeaderFooterOptions(l)}return l},_getODataSearchFields:function(){var o=["CreatedByName","ForwardedByName","ItemDescriptions","PoNumber","PoNumberFormatted","SearchForText","SubstitutingForName","SupplierID","SupplierName","WiCreatedAt","WorkitemID"];if(this.extHookModifySearchableODataFieldsForMasterListSearch){o=this.extHookModifySearchableODataFieldsForMasterListSearch(o)}return o},_getTextsFromUIElementsForSearch:function(i){var u=[];if(i.getIntro())u.push(i.getIntro());if(i.getTitle())u.push(i.getTitle());if(i.getNumber())u.push(i.getNumber());if(i.getNumberUnit())u.push(i.getNumberUnit());if(i.getFirstStatus())u.push(i.getFirstStatus().getText());if(i.getSecondStatus())u.push(i.getSecondStatus().getText());var a=i.getAttributes();for(var j=0;j<a.length;j++){u.push(a[j].getText())}if(this.extHookDefineSearchableUITextsForMasterListSearch){u=this.extHookDefineSearchableUITextsForMasterListSearch(i)}return u},_searchOnODataFields:function(i,f){var o=this._getODataSearchFields();var m=i.getBindingContext(this.sModelName).getProperty();for(var a=0;a<=o.length;a++){var k=o[a];var v="";if(k==="WiCreatedAt"){var M=m[k];var b=sap.ca.ui.model.format.DateFormat.getDateInstance({style:"medium"},sap.ui.getCore().getConfiguration().getLocale());if(M!==""){v=b.format(M,false)}}else{v=m[k]}if(typeof v==="string"){if(v.toLowerCase().indexOf(f)!==-1){return true}}}},_searchOnUITexts:function(i,f){var u=this._getTextsFromUIElementsForSearch(i);for(var a=0;a<=u.length;a++){if(typeof u[a]!=="undefined"&&u[a]!==""){if(u[a].toLowerCase().indexOf(f)!==-1){return true}}}},applySearchPatternToListItem:function(i,f){if(f===""){return true}if(this._searchOnODataFields(i,f)===true){return true}if(this._searchOnUITexts(i,f)===true){return true}return false}});
